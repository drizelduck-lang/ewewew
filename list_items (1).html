<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registered Items</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* Table Styles */
        .item-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1em;
            font-size: 0.9em;
        }
        .item-table th, .item-table td {
            border: 1px solid var(--border-color);
            padding: 0.75em;
            text-align: left;
            vertical-align: middle;
        }
        .item-table th {
            background-color: #0B402D;
            vertical-align: top; /* Align headers to the top */
        }
        .item-table td:nth-child(2) {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            font-weight: 500;
            color: var(--text-color);
        }
        .item-table td {
            font-family: "SFMono-Regular", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            word-break: break-all;
            color: var(--text-muted);
        }
        
        /* Thumbnail Link Styles */
        .preview-link {
            display: inline-block;
            border: none;
            text-decoration: none;
            cursor: pointer;
        }
        .preview-link:hover .preview-img {
            opacity: 0.8;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .preview-img {
            width: 100px;
            height: auto;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            display: block;
            transition: opacity 0.2s, box-shadow 0.2s;
        }

        /* Modal Styles */
        #imageModal {
            display: none;
            position: fixed;
            z-index: 1000;
            padding-top: 50px;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.9);
        }
        #modalImage {
            margin: auto;
            display: block;
            width: auto;
            max-width: 90%;
            max-height: 90vh;
        }
        .modal-close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
        }
        
        /* --- NEW: Feature List Styles --- */
        .features-list-cell {
            vertical-align: top;
            font-size: 0.9em;
            line-height: 1.4;
        }
        .features-list-cell ul {
            margin: 0;
            padding-left: 0; /* Remove default indent */
            list-style-type: none; /* Remove default bullets */
        }
        .features-list-cell li {
            white-space: nowrap; /* Prevent features from wrapping */
        }
        .features-list-cell li strong {
            color: var(--text-color); /* Make feature name clearer */
            display: inline-block;
            width: 100px; /* Align values */
            font-weight: 500;
        }
        /* --- END NEW STYLES --- */
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Registered Items</h1>
        </header>
        
        <div class="card">
            {% if items %}
                <table class="item-table">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Filename</th>
                            <th>Bio-Key</th>
                            <th>Salt</th>
                            <th>Hybrid Hash</th>
                            <th>HMAC</th>
                            <th>Features</th> </tr>
                    </thead>
                    <tbody>
                        {% for item in items %}
                        <tr>
                            <td>
                                {% set image_filename = item.storage_filename or item.file_name %}
                                <a href="{{ url_for('serve_upload', filename=image_filename) }}" 
                                   class="preview-link image-link">
                                    <img src="{{ url_for('serve_upload', filename=image_filename) }}" 
                                         alt="{{ item.file_name }} preview" 
                                         class="preview-img">
                                </a>
                            </td>
                            
                            <td>{{ item.file_name }}</td>
                            
                            <td>{{ item.bio_key }}</td>
                            <td>{{ item.salt }}</td>
                            <td>{{ item.hybrid_hash }}</td>
                            <td>{{ item.hmac }}</td>

                            <td class="features-list-cell">
                                {% if item.features %}
                                <ul>
                                    {% for key, val in item.features.items() %}
                                        <li><strong>{{ key }}:</strong> {{ val }}</li>
                                    {% endfor %}
                                </ul>
                                {% else %}
                                    <span>N/A</span>
                                {% endif %}
                            </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p style="text-align: center; color: var(--text-muted);">No items have been registered yet.</p>
            {% endif %}
            
            <a href="{{ url_for('index') }}" class="btn btn-secondary" style="margin-top: 2em; width: auto; display: inline-block;">Go Back Home</a>
        </div>
    </div>

    <div id="imageModal">
        <span class="modal-close" id="modalClose">&times;</span>
        <img id="modalImage">
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalClose = document.getElementById('modalClose');
            const imageLinks = document.querySelectorAll('.image-link');
            imageLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    modal.style.display = 'block';
                    modalImg.src = this.getAttribute('href');
                });
            });
            const closeModal = () => { modal.style.display = 'none'; };
            modalClose.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) { closeModal(); }
            });
        });
    </script>
</body>

</html>
