<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Result</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        :root {
            --border-color: #e2e8f0;
            --text-muted: #666;
        }
        body { font-family: Arial, sans-serif; margin: 20px; background:#fafafa; }
        .container { max-width:1100px; margin:auto; }
        .card { background:white; padding:18px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.06); }
        .header h1 { margin:0 0 12px; }
        .status-success { color: #155724; font-weight: bold; }
        .status-danger { color: #721c24; font-weight: bold; }
        .status-warning { color: #856404; font-weight: bold; }
        .record-details { margin-top: 1em; }
        .record-item { display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px dashed #eee; }
        .record-label { font-weight:600; color:#333; }
        .record-value { color:#222; }
        .features-list { list-style:none; padding-left:0; margin:0; }
        .visual-comparison { display:grid; grid-template-columns: 1fr 1fr; gap: 1.5em; margin-top:1em; }
        .visual-column h3 { text-align:center; margin-bottom:0.5em; }
        .analysis-image { width:100%; border:1px solid var(--border-color); border-radius:6px; }
        .analysis-image-container { padding:8px; background:#fff; border-radius:6px; }
        .tamper-list { margin:0; padding-left:1.2em; color:#b30000; }
        .btn { display:inline-block; padding:8px 12px; border-radius:6px; text-decoration:none; background:#007bff; color:white; }
        @media (max-width: 900px) {
            .visual-comparison { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Verification Result</h1>
        </header>
        
        <div class="card">
            {% if message %}
            <div class="result-message status-{{ status | default('warning') }}">
                {{ message }}
            </div>
            {% endif %}

            {% if check_results %}
            <div class="record-details">
                <h3>Verification Checks</h3>

                <div class="record-item">
                    <span class="record-label">HMAC Integrity Check</span>
                    <span class="record-value {% if check_results.is_hmac_match %}status-success{% else %}status-danger{% endif %}">
                        {% if check_results.is_hmac_match %}PASS{% else %}FAIL{% endif %}
                    </span>
                </div>
                <div class="record-item">
                    <span class="record-label" style="padding-left: 20px;">Stored HMAC</span>
                    <span class="record-value">{{ record.hmac }}</span>
                </div>
                <div class="record-item">
                    <span class="record-label" style="padding-left: 20px;">Uploaded HMAC</span>
                    <span class="record-value">{{ check_results.new_hmac }}</span>
                </div>

                <div class="record-item">
                    <span class="record-label">Biometric Key Check</span>
                    <span class="record-value {% if check_results.is_biokey_match %}status-success{% else %}status-danger{% endif %}">
                        {% if check_results.is_biokey_match %}PASS{% else %}FAIL{% endif %}
                    </span>
                </div>
                <div class="record-item">
                    <span class="record-label" style="padding-left: 20px;">Stored Bio-Key</span>
                    <span class="record-value">{{ record.bio_key }}</span>
                </div>
                <div class="record-item">
                    <span class="record-label" style="padding-left: 20px;">Uploaded Bio-Key</span>
                    <span class="record-value">{{ check_results.new_bio_key }}</span>
                </div>

                <div class="record-item">
                    <span class="record-label">Salt</span>
                    <span class="record-value">{{ record.salt }}</span>
                </div>

                {% if check_results.tampering_types %}
                <div class="record-item">
                    <span class="record-label">Detected Tampering Type(s)</span>
                    <div class="record-value">
                        <ul class="tamper-list">
                            {% for t in check_results.tampering_types %}
                                <li>{{ t }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endif %}
            </div>
            {% endif %}

            {% if stored_visuals and uploaded_visuals %}
            <div class="visual-comparison">
                <div class="visual-column">
                    <h3>Stored Record Visuals</h3>
                    <div class="analysis-image-container">
                        <p style="text-align:center;font-weight:700;margin:0 0 8px 0;">Leaf Pattern</p>
                        <img src="{{ url_for('static', filename=stored_visuals.leaf.replace('static/','')) }}" alt="Stored Leaf Pattern" class="analysis-image">
                    </div>
                    <div class="analysis-image-container">
                        <p style="text-align:center;font-weight:700;margin:0 0 8px 0;">Fractal Analysis</p>
                        <img src="{{ url_for('static', filename=stored_visuals.fractal.replace('static/','')) }}" alt="Stored Fractal Analysis" class="analysis-image">
                    </div>
                    <div class="analysis-image-container">
                        <p style="text-align:center;font-weight:700;margin:0 0 8px 0;">Skeleton Analysis</p>
                        <img src="{{ url_for('static', filename=stored_visuals.skeleton.replace('static/','')) }}" alt="Stored Skeleton Analysis" class="analysis-image">
                    </div>
                    <div class="analysis-image-container">
                        <p style="text-align:center;font-weight:700;margin:0 0 8px 0;">DFT / FFT</p>
                        <img src="{{ url_for('static', filename=stored_visuals.dft.replace('static/','')) }}" alt="Stored DFT" class="analysis-image">
                    </div>
                    <div class="analysis-image-container">
                        <p style="text-align:center;font-weight:700;margin:0 0 8px 0;">Histogram</p>
                        <img src="{{ url_for('static', filename=stored_visuals.hist.replace('static/','')) }}" alt="Stored Hist" class="analysis-image">
                    </div>
                    <div class="analysis-image-container">
                        <p style="text-align:center;font-weight:700;margin:0 0 8px 0;">FFT Radial Profile</p>
                        <img src="{{ url_for('static', filename=stored_visuals.radial.replace('static/','')) }}" alt="Stored Radial" class="analysis-image">
                    </div>
                </div>
                <div class="visual-column">
                    <h3>Uploaded File Visuals</h3>
                    <div class="analysis-image-container">
                        <p style="text-align:center;font-weight:700;margin:0 0 8px 0;">Leaf Pattern</p>
                        <img src="{{ url_for('static', filename=uploaded_visuals.leaf.replace('static/','')) }}" alt="Uploaded Leaf Pattern" class="analysis-image">
                    </div>
                    <div class="analysis-image-container">
                        <p style="text-align:center;font-weight:700;margin:0 0 8px 0;">Fractal Analysis</p>
                        <img src="{{ url_for('static', filename=uploaded_visuals.fractal.replace('static/','')) }}" alt="Uploaded Fractal Analysis" class="analysis-image">
                    </div>
                    <div class="analysis-image-container">
                        <p style="text-align:center;font-weight:700;margin:0 0 8px 0;">Skeleton Analysis</p>
                        <img src="{{ url_for('static', filename=uploaded_visuals.skeleton.replace('static/','')) }}" alt="Uploaded Skeleton Analysis" class="analysis-image">
                    </div>
                    <div class="analysis-image-container">
                        <p style="text-align:center;font-weight:700;margin:0 0 8px 0;">DFT / FFT</p>
                        <img src="{{ url_for('static', filename=uploaded_visuals.dft.replace('static/','')) }}" alt="Uploaded DFT" class="analysis-image">
                    </div>
                    <div class="analysis-image-container">
                        <p style="text-align:center;font-weight:700;margin:0 0 8px 0;">Histogram</p>
                        <img src="{{ url_for('static', filename=uploaded_visuals.hist.replace('static/','')) }}" alt="Uploaded Hist" class="analysis-image">
                    </div>
                    <div class="analysis-image-container">
                        <p style="text-align:center;font-weight:700;margin:0 0 8px 0;">FFT Radial Profile</p>
                        <img src="{{ url_for('static', filename=uploaded_visuals.radial.replace('static/','')) }}" alt="Uploaded Radial" class="analysis-image">
                    </div>
                </div>
            </div>
            {% elif stored_visuals %}
            <div class="visual-comparison" style="grid-template-columns: 1fr;">
                <div class="visual-column">
                    <h3>Registered Visuals</h3>
                    <div class="analysis-image-container">
                        <p>Leaf Pattern</p>
                        <img src="{{ url_for('static', filename=stored_visuals.leaf.replace('static/','')) }}" alt="Stored Leaf Pattern" class="analysis-image">
                    </div>
                </div>
            </div>
            {% endif %}

            {% if record %}
            <div class="record-details" style="margin-top: 1.5em;">
                <h3>Stored Database Record</h3>
                <div class="record-item">
                    <span class="record-label">File:</span>
                    <span class="record-value">{{ record.file_name }}</span>
                </div>
                <div class="record-item" style="align-items:flex-start;">
                    <span class="record-label">Stored Features:</span>
                    <div class="record-value">
                        <ul class="features-list">
                            {% for key, val in record.features.items() %}
                                <li><strong>{{ key }}:</strong> <span>{{ val }}</span></li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            {% endif %}
            
            {% if report_file %}
            <div style="margin-top:1.25em;">
                <a class="btn" href="{{ url_for('download_report', fname=report_file) }}">Download JSON Report</a>
            </div>
            {% endif %}

            <a href="/" class="btn" style="background:#6c757d; margin-top:1em; display:inline-block;">Go Back Home</a>
        </div>
    </div>
</body>
</html>
